{% include 'head.html' %}
{% include 'navbar.html' %}
{% load custom_tags %}
{% load static %}
{% block content %}

<div class="container l-main">
    <div class="row">
        <div class="col-12">
            {% if is_peticion or peticion or messages or form.non_field_errors or form.errors or field.errors %}
            <h3 class="mb-2">Editar Perfil</h3>
            {% else %}
            <h3>Editar Perfil</h3>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-8">
            {% if is_peticion %}
                <div class="alert alert-warning">
                    <strong>Ya cuentas con una peticion de actualización. Espera a que se apruebe o rechace</strong>
                </div>
            {% endif %}
            
            {% if peticion %}
                <div class="alert alert-danger">
                    <strong>Tu petición de actualizacion ha sido rechazada: {{peticion.motivo}}</strong>
                </div>
                
            {% endif %}
            
    
            <!-- Mensaje de exito -->
            {% if messages %}
                <div class="alert alert-success">
                    {% for message in messages %}
                        <strong>{{message}} </strong>
                    {% endfor %}
                </div>
            {% endif %}
    
            <!-- Mensajes de error sin campo asociado -->
            {% if form.non_field_errors %}
                <div class="non-field-errors">
                    {% for error in form.non_field_errors %}
                        <p class="form-error">
                            {{ error }}
                        </p>
                    {% endfor %}
                </div>
            {% endif %}
    
            {% if form.errors %}
                <div class="alert alert-danger">
                    <strong>Corrigue los siguientes errores:</strong>
                    <ul>
                        {% for field in form %}
                            {% if field.errors %}
                                <p href="#id_{{field.name}}">{{field.label}}{{field.errors|striptags}}<p>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
    
            {% if field.errors %}
                <div class="alert alert-danger">
                    {% for error in field.errors %}
                    <strong>{{error}}</strong>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <!-- Grid de tarjetas -->
        <div class="l-grid col-12">
            <!-- Formulario de actualización de datos -->
            <form class="col-12" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                {{form.user}}
                <div class="l-form">
                    <div class="col-4 pl-0">
                        <div class="m-form-input">
                            <label for="id_first_name">{{form.first_name.label}}</label>
                            {{form.first_name}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_last_name">{{form.last_name.label}}</label>
                            {{form.last_name}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_email">{{form.email.label}}</label>
                            {{form.email}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_clave">{{form.clave.label}}</label>
                            {{form.clave}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_nacimiento">{{form.nacimiento.label}}</label>
                            {{form.nacimiento}}
                        </div>
                    </div>
                    <div class="col-4 pl-0">
                        <div class="m-form-input">
                            <label for="id_sexo">{{form.sexo.label}}</label>
                            {{form.sexo}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_contratacion">{{form.contratacion.label}}</label>
                            {{ form.contratacion|addclass:'custom-select custom-select-sm' }}
                        </div>
                        <div class="m-form-input">
                            <label for="id_cuerpoAcademico">{{form.cuerpoAcademico.label}}</label>
                            {{form.cuerpoAcademico}}
                        </div> 
                        <div class="m-form-input">
                            <label for="id_grado">{{form.grado.label}}</label>
                            {{form.grado|addclass:'custom-select custom-select-sm'}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_publico">{{form.publico.label}}</label>
                            {{form.publico|addclass:'custom-select custom-select-sm'}}
                        </div>
                    </div>
                    <div class="col-4 pl-0">
                        <label>{{form.foto.label}}</label>
                        <div class="m-form-input custom-file">
                            <br>
                            <label class="custom-file-label m-input-file" for="id_foto">Sube una nueva foto</label>
                            {{ form.foto|addclass:'custom-file-input' }}
                        </div>
                        <div class="m-form-input">
                            <label for="id_facultades">{{form.facultades.label}}</label>
                            {{form.facultades|addclass:'m-input-multiselect'}}
                        </div>
                        <div class="m-form-input">
                            <label for="id_investigaciones">{{form.investigaciones.label}}</label>
                            <div class="col-12 pl-0 h-align-center">
                                {{form.investigaciones|addclass:'m-input-multiselect'}}
                                <div class="col-1">
                                    <a href="javascript:void(0);" data-url="{% url 'LineasCreate' %}" id="add_lineas"
                                        onclick="return showAddPopup(this,'id_investigaciones');">
                                        <i class="fas fa-plus-circle"></i>
                                    </a>
                                </div> 
                            </div>  
                        </div> 
                        <div class="m-form-input">
                            <label for="id_niveles">{{form.niveles.label}}</label>
                            <div class="col-12 pl-0 h-align-center">
                                {{form.niveles|addclass:'m-input-multiselect'}}
                                <div class="col-1">
                                <a href="javascript:void(0);" data-url="{% url 'NivelCreate' %}" id="add_niveles"
                                    onclick="return showAddPopup(this, 'id_niveles');">
                                    <i class="fas fa-plus-circle"></i>
                                </a>
                                </div>
                            </div>
                        </div> 
                    </div>
                </div>
                <div class="col-12 pl-0 m-form-button">
                    <div>
                        <small>Tus cambios deben ser aprobados antes de que se vean reflejados en tu perfil</small>
                    </div>
                    <input class="btn m-comunidapp-button" type="submit" name="" id="" value="Editar Perfil">
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
